<html>
<head>

<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!-- Site-wide css -->
	<link rel="stylesheet" href="default.css">


	<title>WYCE</title>
<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>

var homeUrl = "http://localhost:8888/home.html";
var clientId = "";
var  secret = "";
function GetURLParameter(sParam)
	{
		var sPageURL = window.location.search.substring(1);
		var sURLVariables = sPageURL.split('&');
		for (var i = 0; i < sURLVariables.length; i++) 
		{	
			var sParameterName = sURLVariables[i].split('=');
			if (sParameterName[0] == sParam) 
			{
				return sParameterName[1];
			}
		}
	}
	
function setSecret()
{
	callPHP(3,  function(value){
		alert("secret="+value);
		secret = value;
	});
}

function setClientId()
{
	callPHP(2, function(value){
		alert("client="+value);
		clientId = value;
	});
}

function callPHP(callback)
{
	var code = GetURLParameter('code');
	$.ajax({
    	type: "POST",
    	data: {code: code},
    	url: 'getRefreshToken.php'
	    }).done(function (data) {
			if(data == "failure") {
				alert("Failure");
	        }
	        else {
				callback(data);
			}
		});
	}
	
function makeRequest()
{
	callPHP(function (data)
	{	
	/*
		var json = JSON.parse(data.substring(0, data.length-1));
		var access_token =  json.access_token;
		var token_type = json.token_type;
		var scope = json.scope;
		var expires_in = json.expires_in;
		var refresh_token = json.refresh_token;
	*/
	if(data == "success")
	{
		document.location.href = "http://localhost:8888/home.html";
	}
	else
		alert("howdy");
		
	});
}
	
function getRefreshToken(callback)
{
	var code = GetURLParameter('code');
	$.ajax({
    	type: "GET",
    	data: {code: code},
    	url: 'getRefreshToken.js'
	    }).done(function (data) {
			if(data == "failure" ||) {
				alert("Failure");
	        }
	        else {
				callback(data);
			}
		});
}


function sendPost()
{
	var grant_type="authorization_code"
	var homeUrl = "http://localhost:8888/home.html";
	var redirect_uri = homeUrl;
	var json = "";
	
	var clientId = "c5e05e3d23464581955c9312234e3e7e";
	var secret = "2208803f4009467999542bf7a25b0845";
	var code=GetURLParameter('code');
	
	var myData = {
		"data": {
			"code": code,
			"redirect_uri": redirect_uri,
			"grant_type": grant_type
		}
	};
	
	$.ajax({
		url: 'https://accounts.spotify.com/api/token',
		data: myData,
		type: 'POST',
		dataType: 'jsonp',
		success: function(){alert("Success"); },
		error: function(xhr){
        alert('Request Status: ' + xhr.status + ' Status Text: ' + xhr.statusText + ' ' + xhr.responseText);
		console.log(xhr.error);
		},
		beforeSend: setHeader
	});
}

function setHeader(xhr){
	xhr.setRequestHeader('Authorization', 'Basic ' + clientId + ':' + secret);
	alert("header");
}
</script>
</head>
<body>
<h2>
	
</h2>
<p id="result">
 
</p>

	<button id="makeRequest" onclick="makeRequest();">Make Request</button>
<script> 
</script>
</body>
</html>
